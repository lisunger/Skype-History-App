<ui:composition
        xmlns="http://www.w3.org/1999/xhtml"
        xmlns:f="http://java.sun.com/jsf/core"
        xmlns:jsf="http://xmlns.jcp.org/jsf"
        xmlns:h="http://java.sun.com/jsf/html"
        xmlns:ui="http://java.sun.com/jsf/facelets"
        xmlns:p="http://primefaces.org/ui">

    <div jsf:id="panel-chat" class="panel-chat">
        <div class="p-shadow-4" jsf:rendered="#{reader.selectedChat != null}">

            <div class="header">
                <div class="chat-title">#{reader.selectedChat.displayName}</div>
                <div jsf:id="filter" class="filter">
                    <div>
                        <span class="label">Дата: </span>
                        <p:datePicker value="#{reader.filterDateBegin}" mask="99.99.9999" pattern="dd.MM.yyyy" showIcon="true" locale="bg" />
                    </div>

                    <div>
                        <p:commandButton icon="fas fa-check" title="Зареди съобщения" actionListener="#{reader.actionLoadMessages}"
                             update="messages-wrapper" oncomplete="clearEmoticonContent()" styleClass="ui-button-warning"/>
                    </div>
                    
                    <div style="flex-grow: 1; text-align: end;">
                    	<p:commandButton icon="fas fa-bookmark" title="Отметки" actionListener="#{reader.showBookmarks}"
                             update="messages-wrapper"/>
                    </div>
                    
                    <div>
                    	<p:commandButton icon="fas fa-skull-crossbones" action="#{reader.deleteChat}" title="Изтриване" 
                    		update="panel-chats panel-details panel-chat" styleClass="ui-button-danger">
                                <p:confirm message="Изтриване на чата?" icon="fas fa-exclamation-triangle" />
                        </p:commandButton>
                    </div>
                </div>
            </div>

			<!-- PF("dataScrollerChat").getJQ().find(".ui-datascroller-content").animate({scrollTop: 1000}, 400) -->
            <div jsf:id="messages-wrapper" class="messages-wrapper">
                <p:dataScroller value="#{reader.messageLazyModel}" widgetVar="dataScrollerChat" rendered="#{reader.showChat}"
                    var="mess" lazy="true" chunkSize="20" mode="inline" scrollHeight="700" styleClass="messages-scroller">

                    <p:ajax event="load" oncomplete="clearEmoticonContent()" />

					<div class="chat-message-wrapper #{mess.displayName == null ? 'my' : ''}">
						<div id="#{mess.pk.id}" class="message">
	                        <div class="content">
	                            <h:outputText value="#{mess.content}" escape="false"/>
	                        </div>
	                    </div>
						<div class="date">
                            <h:outputText value="#{mess.originalArrivalTime}">
                                <f:convertDateTime pattern="dd.MM.yyyy, HH:mm:ss" timeZone="#{reader.timeZone}"/>
                            </h:outputText>
                        </div>
                        <div class="bookmark-icon">
                        	<p:commandButton icon="#{mess.bookmarked ? 'fas' : 'far'} fa-bookmark" styleClass="rounded-button ui-button-flat" 
                        		actionListener="#{reader.initNewBookmark(mess)}" oncomplete="changeSelectedBookmarkColor(); PF('modalBookmark').show()"
                        		update="modalBookmarkWrapper"/>
                        </div>
                    </div>

                </p:dataScroller>
            </div>
            
        </div>
    </div>

</ui:composition>
